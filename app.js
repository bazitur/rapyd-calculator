(function(){"use strict";function ՐՏ_bind(fn,thisArg){var ret;if(fn.orig){fn=fn.orig}if(thisArg===false){return fn}ret=function(){return fn.apply(thisArg,arguments)};ret.orig=fn;return ret}function ՐՏ_rebindAll(thisArg,rebind){if(rebind===void 0){rebind=true}for(var p in thisArg){if(thisArg[p]&&thisArg[p].orig){if(rebind){thisArg[p]=ՐՏ_bind(thisArg[p],thisArg)}else{thisArg[p]=thisArg[p].orig}}}}function enumerate(item){var arr,iter,i;arr=[];iter=ՐՏ_Iterable(item);for(i=0;i<iter.length;i++){arr[arr.length]=[i,item[i]]}return arr}function ՐՏ_extends(child,parent){child.prototype=Object.create(parent.prototype);child.prototype.__base__=parent;child.prototype.constructor=child}function ՐՏ_Iterable(iterable){var tmp;if(iterable.constructor===[].constructor||iterable.constructor==="".constructor||(tmp=Array.prototype.slice.call(iterable)).length){return tmp||iterable}return Object.keys(iterable)}function range(start,stop,step){var length,idx,range;if(arguments.length<=1){stop=start||0;start=0}step=arguments[2]||1;length=Math.max(Math.ceil((stop-start)/step),0);idx=0;range=new Array(length);while(idx<length){range[idx++]=start;start+=step}return range}function ՐՏ_type(obj){return obj&&obj.constructor&&obj.constructor.name?obj.constructor.name:Object.prototype.toString.call(obj).slice(8,-1)}function hasattr(obj,name){return name in obj}function ՐՏ_eq(a,b){;var ՐՏitr3,ՐՏidx3;var i;if(a===b){return true}if(Array.isArray(a)&&Array.isArray(b)||a instanceof Object&&b instanceof Object){if(a.constructor!==b.constructor||a.length!==b.length){return false}if(Array.isArray(a)){for(i=0;i<a.length;i++){if(!ՐՏ_eq(a[i],b[i])){return false}}}else{if(Object.keys(a).length!==Object.keys(b).length){return false}ՐՏitr3=ՐՏ_Iterable(a);for(ՐՏidx3=0;ՐՏidx3<ՐՏitr3.length;ՐՏidx3++){i=ՐՏitr3[ՐՏidx3];if(!ՐՏ_eq(a[i],b[i])){return false}}}return true}return false}(function(){var __name__="__main__";var ՐՏ_1,ՐՏ_2,ՐՏ_3,ՐՏ_4,ՐՏ_5,ՐՏ_6,ՐՏ_7,ՐՏ_8,ՐՏ_9;;var Nod=(ՐՏ_1=function Nod(){this.add_child=ՐՏ_bind(this.add_child,this);this.add_children=ՐՏ_bind(this.add_children,this);this.__render__=ՐՏ_bind(this.__render__,this);this.__rerender__=ՐՏ_bind(this.__rerender__,this);this.clip_dispatcher=ՐՏ_bind(this.clip_dispatcher,this);Nod.prototype.__init__.apply(this,arguments)},Object.defineProperties(ՐՏ_1.prototype,{__init__:{enumerable:true,writable:true,value:function __init__(){var self=this;ՐՏ_rebindAll(this,true);self.children=[];self.name=ՐՏ_type(self)}},add_child:{enumerable:true,writable:true,value:function add_child(child,pass_dispatcher){var self=this;pass_dispatcher=pass_dispatcher===void 0?false:pass_dispatcher;if(!(child instanceof Nod)){throw new Error("Invalid child")}if(pass_dispatcher){if(!self.dispatcher){throw new Error("Cannot pass dispatcher to child: parent has no dispatcher")}child.clip_dispatcher(self.dispatcher)}child.DOM_path=self.DOM_path+" ."+child.name.toLowerCase();self.children.push(child)}},add_children:{enumerable:true,writable:true,value:function add_children(children,pass_dispatcher){var ՐՏitr1,ՐՏidx1;var self=this;pass_dispatcher=pass_dispatcher===void 0?false:pass_dispatcher;var c;ՐՏitr1=ՐՏ_Iterable(children);for(ՐՏidx1=0;ՐՏidx1<ՐՏitr1.length;ՐՏidx1++){c=ՐՏitr1[ՐՏidx1];self.add_child(c,pass_dispatcher)}}},__render__:{enumerable:true,writable:true,value:function __render__(){;var ՐՏitr2,ՐՏidx2,ՐՏupk1;var self=this;var div,i,child;div=$("<div>").addClass(self.name.toLowerCase());ՐՏitr2=ՐՏ_Iterable(enumerate(self.children));for(ՐՏidx2=0;ՐՏidx2<ՐՏitr2.length;ՐՏidx2++){ՐՏupk1=ՐՏitr2[ՐՏidx2];i=ՐՏupk1[0];child=ՐՏupk1[1];if(child instanceof Nod){div.append(child.__render__().data("idx",i))}else{throw new Error("Invalid child with type '"+ՐՏ_type(child)+"'")}}return div}},__rerender__:{enumerable:true,writable:true,value:function __rerender__(index){var self=this;var args=[].slice.call(arguments,1);var child;child=self.children[index];$(child.DOM_path).replaceWith(child.__render__.apply(child,args))}},clip_dispatcher:{enumerable:true,writable:true,value:function clip_dispatcher(dispatcher){var self=this;self.dispatcher=dispatcher;if(hasattr(self,"dispatcher_clipped")){self.dispatcher_clipped()}}}}),ՐՏ_1);var Button=(ՐՏ_2=function Button(){this.dispatcher_clipped=ՐՏ_bind(this.dispatcher_clipped,this);this._handler=ՐՏ_bind(this._handler,this);this.__render__=ՐՏ_bind(this.__render__,this);Button.prototype.__init__.apply(this,arguments)},ՐՏ_extends(ՐՏ_2,Nod),Object.defineProperties(ՐՏ_2.prototype,{__init__:{enumerable:true,writable:true,value:function __init__(title,span,keybinding){var self=this;span=span===void 0?1:span;keybinding=keybinding===void 0?null:keybinding;ՐՏ_rebindAll(this,true);Nod.prototype.constructor.call(self);self.title=title;self.span=span;self.keybinding=keybinding}},dispatcher_clipped:{enumerable:true,writable:true,value:function dispatcher_clipped(){var self=this;if(self.keybinding){self.dispatcher.add_keybinding(self.keybinding.toString(),self.handle_click)}}},_handler:{enumerable:true,writable:true,value:function _handler(){var self=this;if(hasattr(self,"handle_click")){self.handle_click(self.dispatcher)}}},__render__:{enumerable:true,writable:true,value:function __render__(){var self=this;var b;b=$("<button>").addClass("button is-"+self.span).html(self.title).on("click",self._handler);return b}}}),ՐՏ_2);var Digit=(ՐՏ_3=function Digit(){this.handle_click=ՐՏ_bind(this.handle_click,this);Digit.prototype.__init__.apply(this,arguments)},ՐՏ_extends(ՐՏ_3,Button),Object.defineProperties(ՐՏ_3.prototype,{__init__:{enumerable:true,writable:true,value:function __init__(digit){var self=this;ՐՏ_rebindAll(this,true);Button.prototype.constructor.call(self,digit,1,digit.toString());self.digit=digit}},handle_click:{enumerable:true,writable:true,value:function handle_click(dispatcher){var self=this;dispatcher.push_char(self.digit,self.digit)}}}),ՐՏ_3);var Operator=(ՐՏ_4=function Operator(){this.handle_click=ՐՏ_bind(this.handle_click,this);this.__render__=ՐՏ_bind(this.__render__,this);Operator.prototype.__init__.apply(this,arguments)},ՐՏ_extends(ՐՏ_4,Button),Object.defineProperties(ՐՏ_4.prototype,{__init__:{enumerable:true,writable:true,value:function __init__(rendering,operator,span,colored){var self=this;span=span===void 0?1:span;colored=colored===void 0?false:colored;ՐՏ_rebindAll(this,true);Button.prototype.constructor.call(self,rendering,span,operator);self.operator=operator;self.rendering=rendering;self.colored=colored}},handle_click:{enumerable:true,writable:true,value:function handle_click(dispatcher){var self=this;dispatcher.push_char(self.operator,self.rendering)}},__render__:{enumerable:true,writable:true,value:function __render__(){var self=this;var b;b=Button.prototype.__render__.call(self);if(self.colored){b.addClass("colored")}return b}}}),ՐՏ_4);var Special=(ՐՏ_5=function Special(){this.handle_click=ՐՏ_bind(this.handle_click,this);Special.prototype.__init__.apply(this,arguments)},ՐՏ_extends(ՐՏ_5,Button),Object.defineProperties(ՐՏ_5.prototype,{__init__:{enumerable:true,writable:true,value:function __init__(title,handler,span,keybinding){var self=this;span=span===void 0?1:span;keybinding=keybinding===void 0?null:keybinding;ՐՏ_rebindAll(this,true);Button.prototype.constructor.call(self,title,span,keybinding);self.handler=handler}},handle_click:{enumerable:true,writable:true,value:function handle_click(dispatcher){var self=this;self.handler(dispatcher)}}}),ՐՏ_5);var Dispatcher=(ՐՏ_6=function Dispatcher(){this.add_keybinding=ՐՏ_bind(this.add_keybinding,this);this.handle_keydown=ՐՏ_bind(this.handle_keydown,this);this.push_char=ՐՏ_bind(this.push_char,this);this.pop_char=ՐՏ_bind(this.pop_char,this);this.evaluate=ՐՏ_bind(this.evaluate,this);this.prepare=ՐՏ_bind(this.prepare,this);Dispatcher.prototype.__init__.apply(this,arguments)},Object.defineProperties(ՐՏ_6.prototype,{__init__:{enumerable:true,writable:true,value:function __init__(root){var self=this;ՐՏ_rebindAll(this,true);self.root=root;self.name=ՐՏ_type(self);self.keybindings={};self.query=[];self.rendered_query=[]}},add_keybinding:{enumerable:true,writable:true,value:function add_keybinding(key,foo){var self=this;self.keybindings[key]=foo}},handle_keydown:{enumerable:true,writable:true,value:function handle_keydown(event){var self=this;var key;if(!event.defaultPrevented){key=event.key;if(hasattr(self.keybindings,key)){self.keybindings[key](self);event.preventDefault()}}}},push_char:{enumerable:true,writable:true,value:function push_char(real,render){var self=this;self.query.push(real);self.rendered_query.push(render);self.root.__rerender__(0,self.rendered_query)}},pop_char:{enumerable:true,writable:true,value:function pop_char(){var self=this;self.query.pop();self.rendered_query.pop();self.root.__rerender__(0,self.rendered_query);return self.query.length>0}},evaluate:{enumerable:true,writable:true,value:function evaluate(){var self=this;var ans,rendered_ans;try{if(self.query.length>0){ans=eval(self.query.map(function(c){return c==="^"?"**":c}).join("")).toString();if($.isNumeric(ans)){ans=new Number(ans);if(ans%1!==0){rendered_ans=ans.toPrecision(3)}else{rendered_ans=ans}}else{rendered_ans=ans}}}catch(ՐՏ_Exception){if(ՐՏ_Exception instanceof Error){var E=ՐՏ_Exception;ans="Error";rendered_ans="Error"}else{throw ՐՏ_Exception}}self.query=[ans];self.rendered_query=[rendered_ans];self.root.__rerender__(0,self.rendered_query)}},prepare:{enumerable:true,writable:true,value:function prepare(){var self=this;window.addEventListener("keydown",self.handle_keydown)}}}),ՐՏ_6);var Screen=(ՐՏ_7=function Screen(){this.__render__=ՐՏ_bind(this.__render__,this);Screen.prototype.__init__.apply(this,arguments)},ՐՏ_extends(ՐՏ_7,Nod),Object.defineProperties(ՐՏ_7.prototype,{__init__:{enumerable:true,writable:true,value:function __init__(){var self=this;ՐՏ_rebindAll(this,true);Nod.prototype.constructor.call(self)}},__render__:{enumerable:true,writable:true,value:function __render__(query){var self=this;return $("<div>").addClass("screen").html(query&&query.length>0?query.join(""):"")}}}),ՐՏ_7);var Keyboard=(ՐՏ_8=function Keyboard(){this.dispatcher_clipped=ՐՏ_bind(this.dispatcher_clipped,this);Keyboard.prototype.__init__.apply(this,arguments)},ՐՏ_extends(ՐՏ_8,Nod),Object.defineProperties(ՐՏ_8.prototype,{__init__:{enumerable:true,writable:true,value:function __init__(){var self=this;ՐՏ_rebindAll(this,true);var CLEAR,DELETE,EVALUATE,PLUS,MINUS,TIMES,DIVIDE,DELIM,POWER;Nod.prototype.constructor.call(self);function handle_clear(dispatcher){while(dispatcher.query.length>0){dispatcher.pop_char()}}function remove_last(dispatcher){dispatcher.pop_char()}function evaluate(dispatcher){dispatcher.evaluate()}CLEAR=new Special("C",handle_clear,1,"Delete");DELETE=new Special("<",remove_last,1,"Backspace");EVALUATE=new Special("=",evaluate,2,"Enter");PLUS=new Operator("+","+",1,true);MINUS=new Operator("&ndash;","-",1,true);TIMES=new Operator("&times;","*",1,true);DIVIDE=new Operator("&divide;","/",1,true);DELIM=new Operator(".",".");POWER=new Operator("^","^");self.grid=[CLEAR,DELETE,EVALUATE,new Digit(7),new Digit(8),new Digit(9),PLUS,new Digit(4),new Digit(5),new Digit(6),MINUS,new Digit(1),new Digit(2),new Digit(3),TIMES,DELIM,new Digit(0),POWER,DIVIDE]}},dispatcher_clipped:{enumerable:true,writable:true,value:function dispatcher_clipped(){var self=this;self.add_children(self.grid,true)}}}),ՐՏ_8);var App=(ՐՏ_9=function App(){this.run=ՐՏ_bind(this.run,this);App.prototype.__init__.apply(this,arguments)},ՐՏ_extends(ՐՏ_9,Nod),Object.defineProperties(ՐՏ_9.prototype,{__init__:{enumerable:true,writable:true,value:function __init__(root){var self=this;ՐՏ_rebindAll(this,true);Nod.prototype.constructor.call(self);self.root=$(root);self.DOM_path=root;self.clip_dispatcher(new Dispatcher(self));self.add_child(new Screen);self.add_child(new Keyboard,true);self.dispatcher.prepare()}},run:{enumerable:true,writable:true,value:function run(){var self=this;self.root.hide().html(self.__render__()).fadeIn(500)}}}),ՐՏ_9);if(__name__==="__main__"){$(document).ready(function(){var app;app=new App("#root");app.run()})}})();})();
